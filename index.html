<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŒ World News | Ø§Ø®Ø¨Ø§Ø± Ø²Ù†Ø¯Ù‡</title>
<style>
  body { font-family:"Tahoma",sans-serif; margin:0; padding:0; background:#f1f1f1; direction:rtl; }
  header { background:#1a1a2e; color:#fff; padding:20px; text-align:center; font-size:28px; font-weight:bold; position:sticky; top:0; z-index:100; }
  nav { background:#16213e; text-align:center; padding:10px; position:sticky; top:60px; z-index:100; display:flex; justify-content:center; flex-wrap:wrap; gap:10px; }
  nav button { background:#0f3460; color:#fff; border:none; padding:10px 15px; cursor:pointer; border-radius:5px; font-size:16px; transition:0.3s; }
  nav button.active { background:#e94560; transform:scale(1.05); }
  #search { padding:10px; margin:10px auto; border-radius:5px; border:1px solid #ccc; width:80%; max-width:400px; display:block; transition:0.3s; }
  #search:focus { border-color:#0f3460; box-shadow:0 0 5px #0f3460; outline:none; }
  .news-container { max-width:1000px; margin:auto; padding:20px; }
  .news-item { background:#fff; margin-bottom:20px; padding:15px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.1); transition:all 0.5s; overflow:hidden; }
  .news-item:hover { transform:translateY(-5px) scale(1.02); box-shadow:0 8px 20px rgba(0,0,0,0.25); }
  .news-item img { width:100%; max-height:300px; object-fit:cover; border-radius:8px; margin-bottom:10px; transition:transform 0.5s, filter 0.5s; }
  .news-item img:hover { transform:scale(1.05) rotate(1deg); filter:brightness(1.1); }
  .news-item h3 { margin:10px 0; font-size:20px; color:#1a1a2e; }
  .news-item p { font-size:16px; color:#333; }
  .news-item a { display:inline-block; margin-top:10px; color:#0f3460; text-decoration:none; font-weight:bold; transition:0.3s; }
  .news-item a:hover { color:#e94560; }
  .slider { position:relative; overflow:hidden; border-radius:10px; margin-bottom:20px; }
  .slides { display:flex; transition:transform 1s ease-in-out; }
  .slide { min-width:100%; box-sizing:border-box; position:relative; opacity:0; transform:translateX(100%); transition:opacity 1s ease, transform 1s ease; }
  .slide.active { opacity:1; transform:translateX(0); }
  .slide img { width:100%; max-height:400px; object-fit:cover; border-radius:10px; }
  .slide h2 { position:absolute; bottom:20px; right:20px; background:rgba(0,0,0,0.6); color:#fff; padding:10px; border-radius:5px; font-size:22px; }
  @media(max-width:768px){ .news-item h3{ font-size:18px; } .news-item p{ font-size:14px; } .slide h2{ font-size:18px; } nav { flex-direction:column; } }
</style>
</head>
<body>

<header>ğŸŒ World News | Ø§Ø®Ø¨Ø§Ø± Ø²Ù†Ø¯Ù‡</header>
<nav>
  <button onclick="loadNews('bbc', this)" class="active">BBC</button>
  <button onclick="loadNews('cnn', this)">CNN</button>
  <button onclick="loadNews('aljazeera', this)">Al Jazeera</button>
</nav>
<input type="text" id="search" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ø®Ø¨Ø§Ø±..." oninput="filterNews()">

<div class="news-container">
  <div class="slider" id="slider"></div>
  <div id="news"><p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø®Ø¨Ø±Ù‡Ø§...</p></div>
</div>

<script>
let currentSource='bbc';
let newsItems=[];
let displayedCount=0;
let loading=false;
let slideIndex=0;
let slideInterval;

async function loadNews(source, btn){
  currentSource=source;
  displayedCount=0;
  newsItems=[];
  clearInterval(slideInterval);
  document.getElementById("news").innerHTML="<p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø®Ø¨Ø±Ù‡Ø§...</p>";
  document.getElementById("slider").innerHTML="";

  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');

  const urls={
    bbc:"http://feeds.bbci.co.uk/persian/rss.xml",
    cnn:"http://rss.cnn.com/rss/edition.rss",
    aljazeera:"https://www.aljazeera.com/xml/rss/all.xml"
  };
  const url=urls[source]||urls.bbc;
  const proxy="https://api.allorigins.win/get?url="+encodeURIComponent(url);

  try{
    const res=await fetch(proxy);
    const data=await res.json();
    const parser=new DOMParser();
    const xml=parser.parseFromString(data.contents,"text/xml");
    const items=xml.querySelectorAll("item");

    items.forEach(item=>{
      const title=item.querySelector("title")?.textContent||"";
      const link=item.querySelector("link")?.textContent||"#";
      const desc=item.querySelector("description")?.textContent||"";
      const media=item.querySelector("media\\:content, enclosure");
      const image=media?.getAttribute("url")||"";
      newsItems.push({title,link,desc,image});
    });

    setupSlider();
    loadMoreNews();
  }catch(err){
    document.getElementById("news").innerHTML="<p>Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø®Ø¨Ø±Ù‡Ø§.</p>";
  }
}

function displayNews(start,count){
  const newsDiv=document.getElementById("news");
  for(let i=start;i<start+count&&i<newsItems.length;i++){
    const item=newsItems[i];
    const newsItem=document.createElement("div");
    newsItem.className="news-item";
    newsItem.innerHTML=`
      ${item.image?`<img src="${item.image}" alt="news image"/>`:""}
      <h3>${item.title}</h3>
      <p>${item.desc}</p>
      <a href="${item.link}" target="_blank">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø§Ù…Ù„ Ø®Ø¨Ø±</a>
    `;
    newsDiv.appendChild(newsItem);
  }
  displayedCount+=count;
}

function loadMoreNews(){
  if(loading) return;
  loading=true;
  displayNews(displayedCount,5);
  loading=false;
}

window.addEventListener('scroll', ()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 100){
    loadMoreNews();
  }
});

function setupSlider(){
  const sliderDiv=document.getElementById("slider");
  sliderDiv.innerHTML="";
  newsItems.slice(0,3).forEach((item,i)=>{
    const slide=document.createElement("div");
    slide.className="slide"+(i===0?" active":"");
    slide.innerHTML=`<img src="${item.image}" alt=""><h2>${item.title}</h2>`;
    sliderDiv.appendChild(slide);
  });
  const slides=document.querySelectorAll(".slide");
  slideIndex=0;
  slideInterval=setInterval(()=>{
    slides.forEach(s=>s.classList.remove("active"));
    slideIndex=(slideIndex+1)%slides.length;
    slides[slideIndex].classList.add("active");
  },4000);
}

// Ø¬Ø³ØªØ¬ÙˆÛŒ Ø²Ù†Ø¯Ù‡
function filterNews(){
  const query=document.getElementById('search').value.toLowerCase();
  document.getElementById("news").innerHTML="";
  displayedCount=0;
  const filtered=newsItems.filter(item=>item.title.toLowerCase().includes(query) || item.desc.toLowerCase().includes(query));
  filtered.forEach(item=>{
    const newsDiv=document.getElementById("news");
    const newsItem=document.createElement("div");
    newsItem.className="news-item";
    newsItem.innerHTML=`
      ${item.image?`<img src="${item.image}" alt="news image"/>`:""}
      <h3>${item.title}</h3>
      <p>${item.desc}</p>
      <a href="${item.link}" target="_blank">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ø§Ù…Ù„ Ø®Ø¨Ø±</a>
    `;
    newsDiv.appendChild(newsItem);
  });
}

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ BBC
loadNews('bbc', document.querySelector('nav button'));
</script>

</body>
</html>
